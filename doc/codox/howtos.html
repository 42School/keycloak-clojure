<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>HOWTOs</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="highlight/github.css" /><script type="text/javascript" src="highlight/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h1><a href="index.html"><span class="project-title"><span class="project-name">keycloak-clojure</span> <span class="project-version">1.14.4</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="concepts.html"><div class="inner"><span>Security Concepts</span></div></a></li><li class="depth-1 "><a href="setup.html"><div class="inner"><span>Setup Keycloak</span></div></a></li><li class="depth-1 "><a href="admin.html"><div class="inner"><span>Administrative tasks</span></div></a></li><li class="depth-1 "><a href="frontend.html"><div class="inner"><span>Securing a frontend</span></div></a></li><li class="depth-1 "><a href="backend.html"><div class="inner"><span>Securing a backend</span></div></a></li><li class="depth-1  current"><a href="howtos.html"><div class="inner"><span>HOWTOs</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>keycloak</span></div></div></li><li class="depth-2 branch"><a href="keycloak.admin.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>admin</span></div></a></li><li class="depth-2 branch"><a href="keycloak.authn.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>authn</span></div></a></li><li class="depth-2 branch"><a href="keycloak.authz.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>authz</span></div></a></li><li class="depth-2 branch"><a href="keycloak.backend.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>backend</span></div></a></li><li class="depth-2 branch"><a href="keycloak.bean.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bean</span></div></a></li><li class="depth-2 branch"><a href="keycloak.cookies.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cookies</span></div></a></li><li class="depth-2 branch"><a href="keycloak.deployment.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>deployment</span></div></a></li><li class="depth-2 branch"><a href="keycloak.meta.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>meta</span></div></a></li><li class="depth-2 branch"><a href="keycloak.starter.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>starter</span></div></a></li><li class="depth-2 branch"><a href="keycloak.user.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>user</span></div></a></li><li class="depth-2 branch"><a href="keycloak.utils.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>utils</span></div></a></li><li class="depth-2"><a href="keycloak.vault.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>vault</span></div></a></li></ul></div><div class="document" id="content"><div class="doc"><div class="markdown"><h1><a href="#howtos" name="howtos"></a>HOWTOs</h1>
<!-- markdown-toc start - Don't edit this section. Run M-x markdown-toc-refresh-toc -->
<ul>
  <li><a href="#how-to-obtain-an-access-token">How-to obtain an Access Token?</a>
    <ul>
      <li><a href="#with-an-http-request-through-curl">With an HTTP request through curl</a></li>
      <li><a href="#with-an-http-request-programmatically-through-clojure">With an HTTP request programmatically through Clojure</a></li>
      <li><a href="#with-keycloak-clojure-then-verifying-and-extracting-the-token">With Keycloak-Clojure then verifying and extracting the token</a></li>
    </ul>
  </li>
</ul>
<!-- markdown-toc end -->
<h2><a href="#how-to-obtain-an-access-token-" name="how-to-obtain-an-access-token-"></a>How-to obtain an Access Token?</h2>
<p>The access token represents the authorization of a specific application to access specific parts of a user’s data. Access Token are short lived token given by the authorization server (Keycloak) to the client to access user’s data. Access Token can be retrieved programmatically for some automation needs or testing. See the <a href="/concepts.html">OAuth2 concepts section</a>.</p>
<h3><a href="#with-an-http-request-through-curl" name="with-an-http-request-through-curl"></a>With an HTTP request through curl</h3>
<pre><code class="bash">curl -k --data "grant_type=client_credentials&amp;client_id=admin-cli&amp;client_secret=dfefe9a3-7781-439a-b37f-74de0db03b11" https://localhost:8090/auth/realms/&lt;your-realm&gt;/protocol/openid-connect/token`
</code></pre>
<h3><a href="#with-an-http-request-programmatically-through-clojure" name="with-an-http-request-programmatically-through-clojure"></a>With an HTTP request programmatically through Clojure</h3>
<pre><code class="clojure">;;using only HTTP client libs
(keycloak.authn/authenticate "http://localhost:8090/auth" "your-realm" "your-client-id" "username" "password")
;; {:access_token
;;  "eyJhbGciOiJSUzI1NiIsInR5cCIgOiA...",
;;  :expires_in 300,
;;  :refresh_expires_in 1800,
;;  :refresh_token "eyJhbGciOiJIUzI1Ni....",
;;  :token_type "bearer",
;;  :not-before-policy 0,
;;  :session_state "2e04423e-ab23-4b74-9776-946d26687353",
;;  :scope "email profile"}
</code></pre>
<h3><a href="#with-keycloak-clojure-then-verifying-and-extracting-the-token" name="with-keycloak-clojure-then-verifying-and-extracting-the-token"></a>With Keycloak-Clojure then verifying and extracting the token</h3>
<pre><code class="clojure"><br />(require '[keycloak.backend    :as backend]
         '[keycloak.deployment :as deployment]
         '[keycloak.admin      :as admin]
         '[keycloak.authz      :as authz]
         '[keycloak.authn      :as authn])
(def ADMIN_LOGIN     "admin")
(def ADMIN_PWD       "password")
(def AUTH_SERVER_URL "http://localhost:8090/auth")

;;first build an admin client
(def kc-client    (deployment/keycloak-client (deployment/client-conf AUTH_SERVER_URL "master" "admin-cli") ADMIN_LOGIN ADMIN_PWD))
;;extract the client secret programmatically 
(def secret       (admin/get-client-secret kc-client "your-realm" "your-client-id"))
;;build an authorization client to get an access token
(def kc-authz     (authz/authz-client (deployment/client-conf-input-stream AUTH_SERVER_URL "electre" "diffusion-backend" secret)))
;;get the access token
(def access-token (authn/access-token kc-authz "user" "password"))

;;build a deployment (Keycloak lib being embedded in a client)
(def deployment (deployment/deployment-for-realm kc-client AUTH_SERVER_URL "diffusion-frontend" "electre"))
;; then verify and extract the access token we get (with whatever method we want)
(def clojure-access-token (-&gt;&gt; (:access_token access-token)
                               (deployment/verify deployment)
                               deployment/extract))

</code></pre></div></div></div></body></html>